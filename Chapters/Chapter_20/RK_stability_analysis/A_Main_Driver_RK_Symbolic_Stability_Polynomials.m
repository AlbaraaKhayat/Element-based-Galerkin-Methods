%---------------------------------------------------------------------%
%This code solves for the stability polynomial for RK methods written in
%either Butcher tableau form or in Low-storage form. The Shu-Osher forms
%can also be done but must use David Ketcheson's conversion m-file. 
%Written by F.X. Giraldo on 9/25/2019
%           Department of Applied Mathematics
%           Naval Postgraduate School
%           Monterey, CA 93943-5216
%---------------------------------------------------------------------%
close all
clear all

syms z

%RK2 (Midpoint Rule)
ARK2=zeros(2,2);
BRK2=zeros(2,1);
ARK2(2,1)=1;
BRK2(1)=1/2;
BRK2(2)=1/2;

%ARK232
ARK232=zeros(3,3);
BRK232=zeros(3,1);
ARK232(2,1)=0.5857864376269049511983112757903019214303281246230519;
ARK232(3,1)=0.02859547920896831706610375859676730714344270820768398;
ARK232(3,2)=0.9714045207910316829338962414032326928565572917923160;
BRK232(1)=0.3535533905932737622004221810524245196424179688442370;
BRK232(2)=0.3535533905932737622004221810524245196424179688442370;
BRK232(3)=0.2928932188134524755991556378951509607151640623115260;

%WS RK3
ARK3=zeros(3,3);
BRK3=zeros(3,1);
ARK3(2,1)=1.0/3.0;
ARK3(3,2)=1.0/2.0;
BRK3(3)=1.0;

%Ruuth 2006 RK35 (Math. Comput.,75(253):183?208, 2006)
ARK53a=zeros(5,5);
BRK53a=zeros(5,1);
ARK53a(2,1)=0.377268915331368;
ARK53a(3,1)=0.377268915331368;
ARK53a(3,2)=0.377268915331368;
ARK53a(4,1)=0.24299522053739;
ARK53a(4,2)=0.24299522053739;
ARK53a(4,3)=0.24299522053739; 
ARK53a(5,1)=0.15358906769512;
ARK53a(5,2)=0.15358906769512;
ARK53a(5,3)=0.15358906769512;
ARK53a(5,4)=0.23845893284629;
BRK53a(1)  =0.20673402086480;
BRK53a(2)  =0.20673402086480;
BRK53a(3)  =0.117097251841844;
BRK53a(4)  =0.18180256012014;
BRK53a(5)  =0.287632146308408;
% CRK53a = 0   0.149659021999229   0.370400957364205   0.622255763134443   0.958282130674690

%Higueras SSP53 2N Low-Storage (Higueras-Roldan ArXiv 2018)
ARK53b=zeros(5,5);
BRK53b=zeros(5,1);
ARK53b(2,1)=0.443568244942995;
ARK53b(3,1)=0.443568244942995;
ARK53b(3,2)=0.291111420073766;
ARK53b(4,1)=0.443568244942995;
ARK53b(4,2)=0.291111420073766;
ARK53b(4,3)=0.27061260127822; 
ARK53b(5,1)=0.19011179219529;
ARK53b(5,2)=0.12476933240758;
ARK53b(5,3)=0.11598361065329;
ARK53b(5,4)=0.110577759392786;
BRK53b(1)  =0.19011179219529;
BRK53b(2)  =0.124769332407581;
BRK53b(3)  =0.1159836106532;
BRK53b(4)  =0.110577759392786;
BRK53b(5)  =0.4585575053510519;
% CRK53b = 0   0.443568244942995   0.734679665016761   1.005292266294981   0.541442494648946

%Classical RK4
ARK4=zeros(4,4);
BRK4=zeros(4,1);
ARK4(2,1)=1/2;
ARK4(3,2)=1/2;
ARK4(4,3)=1;
BRK4(1)=1/6;
BRK4(2)=1/3;
BRK4(3)=1/3;
BRK4(4)=1/6;

%LSRK(5,4) Kennedy-Carpenter 2002
a=zeros(5,1);
b=zeros(5,1);
a(1) = 0;         
b(1) = 1432997174477.0 / 9575080441755.0;
a(2) = -567301805773.0 / 1357537059087.0;  
b(2) = 5161836677717.0 / 13612068292357.0;
a(3) = -2404267990393.0 / 2016746695238.0; 
b(3) = 1720146321549.0 / 2090206949498.0;
a(4) = -3550918686646.0 / 2091501179385.0; 
b(4) = 3134564353537.0 / 4481467310338.0;
a(5) = -1275806237668.0 / 842570457699.0;  
b(5) = 2277821191437.0 / 14882151754819.0;
[ARK54,BRK54,CRK54] = ConvertLSRK(a,b);
%Butcher Tableau
% ARK54 =
% 
%                    0                   0                   0                   0                   0
%    0.149659021999229                   0                   0                   0                   0
%   -0.008809355635422   0.379210312999627                   0                   0                   0
%    0.401177653646238  -0.601876919898777   0.822955029386982                   0                   0
%   -0.190429699852496   0.813822622443733  -0.364561247865668   0.699450455949122                   0
% BRK54 =0.005594188455007   0.344743042340567   0.028911816184090   0.467693705052184   0.153057247968152
% CRK54 =            0   0.149659021999229   0.370400957364205   0.622255763134443   0.958282130674690


%LSRK(14,4) Niegemann et al. 2012
a=zeros(14,1);
b=zeros(14,1);
a(1) = 0;
a(2) = -0.7188012108672410;
a(3) = -0.7785331173421570;
a(4) = -0.0053282796654044;
a(5) = -0.8552979934029281;
a(6) = -3.9564138245774565;
a(7) = -1.5780575380587385;
a(8) = -2.0837094552574054;
a(9) = -0.7483334182761610;
a(10) = -0.7032861106563359;
a(11) =  0.0013917096117681;
a(12) = -0.0932075369637460;
a(13) = -0.9514200470875948;
a(14) = -7.1151571693922548;
b(1) = 0.0367762454319673;
b(2) = 0.3136296607553959;
b(3) = 0.1531848691869027;
b(4) = 0.0030097086818182;
b(5) = 0.3326293790646110;
b(6) = 0.2440251405350864;
b(7) = 0.3718879239592277;
b(8) = 0.6204126221582444;
b(9) = 0.1524043173028741;
b(10) = 0.0760894927419266;
b(11) = 0.0077604214040978;
b(12) = 0.0024647284755382;
b(13) = 0.0780348340049386;
b(14) = 5.5059777270269628;
[ARK144,BRK144,CRK144] = ConvertLSRK(a,b);
% CRK144=0
%        0.036776245431967
%        0.124968526272503
%        0.244617770227770
%        0.247614953107042
%        0.296931112038247
%        0.397814964580264
%        0.527085458944033
%        0.698126999417569
%        0.819089083535213
%        0.852705988709862
%        0.860471181746282
%        0.862706037696998
%        0.873421312760098

%From Matthew Fletcher's thesis: a(2) is missing a one after 88012
a=zeros(14,1);
b=zeros(14,1);
a(1)=0;
b(1)=0.0367762454319673;
a(2)=-0.718801208672410;
b(2)=0.313629660755396;
a(3)=-0.778533117342157;
b(3)=0.153184869186903;
a(4)=-0.00532827966540440;
b(4)=0.00300970868181820;
a(5)=-0.855297993402928;
b(5)=0.332629379064611;
a(6)=-3.95641382457746;
b(6)=0.244025140535086;
a(7)=-1.57805753805874;
b(7)=0.371887923959228;
a(8)=-2.08370945525741;
b(8)=0.620412622158244;
a(9)=-0.748333418276161;
b(9)=0.152404317302874;
a(10)=-0.703286110656336;
b(10)=0.0760894927419266;
a(11)=0.00139170961176810;
b(11)=0.00776042140409780;
a(12)=-0.0932075369637460;
b(12)=0.00246472847553820;
a(13)=-0.951420047087595;
b(13)=0.0780348340049386;
a(14)=-7.11515716939226;
b(14)=5.50597772702696;
%[ARK144,BRK144,CRK144] = ConvertLSRK(a,b);

%A=ARK2;B=BRK2;
%A=ARK232; B=BRK232;
%A=ARK3;B=BRK3;
%A=ARK53a;B=BRK53a; %Ruuth SSP53
%A=ARK53b;B=BRK53b; %Higueras SSP53-LSRK
%A=ARK4;B=BRK4;
%A=ARK54;B=BRK54;
A=ARK144;B=BRK144;
s=length(B);
B=B';
for i=1:s
    C(i)=sum(A(i,:));
end

%Expression from Butcher book P. 230 (Lemma 351A)
simplify(det(eye(s)-z*A+z*ones(s,1)*B)/det(eye(s)-z*A))

sum(B)


