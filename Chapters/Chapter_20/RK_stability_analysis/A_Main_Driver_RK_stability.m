%---------------------------------------------------------------------%
%This code plots the stability region of Various RK-based methods. It uses 
%the polynomial in symbolic form which comes from
%Driver_RK_Symbolic_Stability_Polynomial.
%Written by F.X. Giraldo on 9/25/2019
%           Department of Applied Mathematics
%           Naval Postgraduate School
%           Monterey, CA 93943-5216
%---------------------------------------------------------------------%
close all;
clear all;

xv =linspace(-20,5,100);
yv =linspace(-15,15,100);
[x,y] =meshgrid(xv,yv);
z = x + 1i*y;

method=-1;
while method ~= 0
 
    %Pick time-integrator
    method=input(' 1=RK1 \n 2=RK2 \n 3=ARK(2,3,2) \n 4=WS-RK3 \n 5=RK53(Ruuth) \n 6=RK53(Higueras) \n 7=RK4 \n 8=LSRK(5,4) \n 9=LSRK(14,4) \n Enter Method: ');

    if (method == 1) %RK1
        %RK1 
        Rz=z + 1; 
        text=['k-'];
        stages=1;
        
    elseif (method == 2) %RK2
        %RK2 (Midpoint Rule)
        Rz=z.^2/2 + z + 1; 
        text=['r-'];
        stages=2;

    elseif (method == 3) %ARK232
        %ARK232
        Rz=(5276295164430439*z)/18014398509481984 + (2^(1/2)*z)/2 + (5276295164430439*2^(1/2)*z.^2)/36028797018963968 + (1520788539931243194793277502945177*z.^2)/5192296858534827628530496329220096 + (243583606221817163768162126816275825717333900931*z.^3)/1461501637330902918203684832716283019655932542976 + 1;
        text=['b-'];
        stages=3;

    elseif (method == 4) %WS-RK3
        %WSRK3
        Rz=z.^3/6 + z.^2/2 + z + 1; 
        text=['g-'];
        stages=3;

    elseif (method == 5) %SSP-RK53-Ruuth
        %Ruuth 2006 SSP53 Shu-Osher form
        Rz=(9000769114863075782748175069059647213310173027658671997239788982637563117414631*z.^5)/3794275180128377091639574036764685364535950857523710002444946112771297432041422848 + (6621842341476027393230552369554895249384886143380381036534119099*z.^4)/210624583337114373395836055367340864637790190801098222508621955072 + (1948668849774486662453560068705548307334161823333*z.^3)/11692013098647223345629478661730264157247460343808 + (324518553658420410637245431757241*z.^2)/649037107316853453566312041152512 + (1125899906842615*z)/1125899906842624 + 1;
        text=['y-'];
        stages=5;

    elseif (method == 6) %SSP-RK53-Higueras
        %Higueras-Roldan 2018 SSP53-LSRK
        %Rz=(1680730694976881694111442986613817676702092940693027881843760127046130022078533*z.^5)/948568795032094272909893509191171341133987714380927500611236528192824358010355712 + (2881380826514888737882664920633243654371245393632556960931946863*z.^4)/105312291668557186697918027683670432318895095400549111254310977536 + (974334424887201129652898457150352029013281205121*z.^3)/5846006549323611672814739330865132078623730171904 + (324518553658383343765028495701631*z.^2)/649037107316853453566312041152512 + (36028797018960685*z)/36028797018963968 + 1;
        Rz=1 + z + 1/2*z.^2 + 1/6*z.^3 + 0.027360346839505386*z.^4 + 0.0017718595675709542*z.^5; %analytic form (they match)
        text=['m-'];
        stages=5;

    elseif (method == 7) %Classical RK4
        %Classical RK4
        Rz=z.^4/24 + z.^3/6 + z.^2/2 + z + 1;
        text=['k--'];
        stages=4;

    elseif (method == 8) %Classical LSRK(5,4)
        %LSRK(5,4)
        Rz=(1185710993790117799294522766619425439296462153355052209717223859821096072722345*z.^5)/237142198758023568227473377297792835283496928595231875152809132048206089502588928 + (4388012152856549708617035574312905622031417299677250207016099171*z.^4)/105312291668557186697918027683670432318895095400549111254310977536 + (1948668849774537299202310164330868238093746377389*z.^3)/11692013098647223345629478661730264157247460343808 + (649037107316853463293701615486073*z.^2)/1298074214633706907132624082305024 + z + 1;
        text=['r--'];
        stages=5;

    elseif (method == 9) %Classical LSRK(14,4)
        %LSRK(14,4)
        Rz=(195015455956141118021611679181898226187643149341587761349212150122075599431966601702138126825657690968436899206316181169114484832145197085053289627704862918877892463128705499296084290202210409625*z.^14)/20547405865423334012660116730000502599806014854778022888665159777612234977722971961381509907334329887605402222094446162941482157227280483840343026447858909570137592465345486711686186554235635614340989264592896 + (44549016444592133998696482819292847147362794439440071820936029048450038001282065863323093979144468959918178267493833648398977999263283188778914968204046335937845177391466640982710346179295*z.^13)/38272525864510487788655081260950309410329935801733327822136058989190002861848048793862592256319392263154317107227530633921701753935367770195646260767912323717284188541295913442384799112073398408183808 + (1185663725563959660157309434120358492312526615761938906572785782983735795906869055874729839979135039372410598794641917538651372657674445484769309578425427813740958751493147773609169*z.^12)/17822033662586700072817076584766762987864173856439687228824970773044043621908896041038721919208482030385321521771853153557377752817872804680674458280164899172859354196719784961261227313463296 + (2439740477276146674951253600947499579458969359751950918689222129878536895430188840447474005290090900343231947298878128923078074770885854823498199359221580392671214201596703*z.^11)/1037378892220248239628101965922790287753111558060609224998914332422663202853227036599926762236775948572049471652825197295598787768852943826971718708528490921765295450850377380921344 + (6628346302776023958674281733422219085601574643516885519032951028209019026086110996701651635210153094351237302200736647014494976255027672563100023257186134397*z.^10)/115172193140305827399949785796761135587064246228529065807379342658863042065190089480167441564259605943037975312218134915154131611020654072038617988630148194691448832 + (6609474800432626798305737110582597090875984898985446364945303439836153296456275779960124541252061269815789883694453697317923079811876625049691*z.^9)/6393341031047152089869511126616404594173128996177860916959553453312761321102879990006386899074031556935325554936640763689877454191182408307282280448 + (20023835976751855257014483338276196486295997038163361326440716863776338313781134458586805483822241938904820699213097108209378763*z.^8)/1419606883389857208104148062281258856159455782592418086487285545274686109596480318996466895925319463985864300012238628776434768805888 + (5878993817434508511619840057238791822773390772761315676477861741463023642140644250833989506017138275941495974025*z.^7)/39402006196394479212279040100143613805079739270465446667948293404245721771497210611414266254884915640806627990306816 + (2707853397973914098343241591801353727519801318422910853501466035329390819041143964864611449070337*z.^6)/2187250724783011924372502227117621365353169430893212436425770606409952999199375923223513177023053824 + (122891222895144386943031888312609524276745100632412795570318500028570470452604619*z.^5)/15177100720513508366558296147058741458143803430094840009779784451085189728165691392 + (280832777782818117313258945787486004884738597890078159836353040727*z.^4)/6739986666787659948666753771754907668409286105635143120275902562304 + (31178701596392616290653543057584343063282466035105*z.^3)/187072209578355573530071658587684226515959365500928 + (1298074214633712413885842032859439*z.^2)/2596148429267413814265248164610048 + (36028797018963743*z)/36028797018963968 + 1;
        text=['b--'];
        stages=14;
    end

    %Plot Contours
    hold on;
    contour(x/stages,y/stages, abs(Rz),[1 1],text,'LineWidth',2)
    axis([-2,0.25,-1,1]);
end %while

%Plot Vertical Line at Imaginary Axis
hold on;
yy=-20:0.1:20;
nn=size(yy);
xx=zeros(nn);
plot(xx,yy,'k:','LineWidth',2);
%axis([-2,0.25,-1,1]);

xlabel('Re(z)/stages','FontSize',18); 
ylabel('Im(z)/stages','FontSize',18); 
%legend('RK1','RK2','ARK(2,3,2)','WSRK3','SSP(5,3)R','SSP(5,3)H','RK4','LSRK(5,4)','LSRK(14,4)');
legend('RK1','RK2','ARK(2,3,2)','SSP(5,3)R','SSP(5,3)H','RK4','LSRK(5,4)','LSRK(14,4)');
set(gca,'FontSize',18);
%grid